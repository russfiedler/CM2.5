<html>
<head>
  <meta name="generator" content=
  "HTML Tidy for Linux/x86 (vers 1 September 2005), see www.w3.org">
  <meta http-equiv="Content-Type" content=
  "text/html; charset=us-ascii">

  <title>Mosaic Tool User Guide</title>
  <link rel="stylesheet" href=
  "http://cobweb.gfdl.noaa.gov/fms/style/docbook.css" type=
  "text/css">
  <meta name="generator" content="DocBook XSL Stylesheets V1.64.1">
  <meta name="description" content=
  "Mosaic Tool User Guide">
</head>

<body bgcolor="white" text="black" link="#0000FF" vlink="#840084"
alink="#0000FF">
  <div class="article" lang="en">
    <div class="titlepage">
      <div>
        <div>
          <h1 class="title"><a name="id2440054"></a>Mosaic Tool User Guide</h1>
        </div>

        <div>
          <div class="author">
            <h3 class="author"><span class="firstname">Zhi</span>
            <span class="surname">Liang</span></h3><a href=""
            onclick=
            "javascript:window.location='mai'+'lt'+'o:'+'Zhi.Liang'+'%40'+'@noaa.gov'"
            onmouseover=
            "javascript:window.status='send ema'+'il';return true;"
            onmouseout=
            "javascript:window.status='';return true;">Zhi.Liang<img border="0"
            src="http://www.gfdl.noaa.gov/fms/images/atgreen.png"
            alt="&amp;#64;" style=
            "display:inline; height:.8em;">@noaa.gov</a>
          </div>
        </div>

      </div>
      <hr>
    </div>

    <div xmlns="http://www.w3.org/TR/xhtml1/transitional" class=
    "toc">
      <p class="subtitle"><b>1. Summary of the tools</b></p>
       There are many tools available under the directory tools(click
        the link to see the detailed user guide of each tool):

<pre>
 <a href=#fregrid                >fregrid                </a>  : regrid data from one mosaic grid to another mosaic grid
 <a href=#make_coupler_mosaic    >make_coupler_mosaic    </a>  : make exchange grid between component models
 <a href=#make_hgrid             >make_hgrid             </a>  : create horizontal grids
 <a href=#make_solo_mosaic       >make_solo_mosaic       </a>  : generate solo mosaic for one componet model
 <a href=#make_topog             >make_topog             </a>  : create topography data on model grid for mosaic
 <a href=#make_vgrid             >make_vgrid             </a>  : create vertical grid
 <a href=#make_regional_mosaic   >make_regional_mosaic   </a>  : create mosaic grid for regional output
 <a href=#check_mask             >check_mask             </a>  : create mask table containing processors to be masked out
 <a href=#runoff_regrid          >runoff_regrid          </a>  : remap runoff data from one mosaic to another mosaic grid
 <a href=#remap_land             >remap_land             </a>  : remap land restart file from one mosaic to another mosaic grid
 <a href=#river_regrid           >river_regrid           </a>  : remap river network data file from global regular lat-lon grid
                            onto any mosaic grid.
 <a href=#transfer_to_mosaic_grid>transfer_to_mosaic_grid</a>  : transfer previous version grid into mosaic grid. 
</pre>

 The following are the precompiled executables (four are compiled for
        parallel processors) to be on the GFDL analysis cluster (only available
        to GFDL users).
<pre>
   /home/z1l/bin/tools/fregrid
   /home/z1l/bin/tools/fregrid_parallel
   /home/z1l/bin/tools/make_coupler_mosaic
   /home/z1l/bin/tools/make_coupler_mosaic_parallel
   /home/z1l/bin/tools/make_hgrid
   /home/z1l/bin/tools/make_solo_mosaic
   /home/z1l/bin/tools/make_topog
   /home/z1l/bin/tools/make_topog_parallel
   /home/z1l/bin/tools/make_vgrid
   /home/z1l/bin/tools/make_regional_mosaic
   /home/z1l/bin/tools/check_mask
   /home/z1l/bin/tools/runoff_regrid
   /home/z1l/bin/tools/remap_land
   /home/z1l/bin/tools/remap_land_parallel
   /home/z1l/bin/tools/river_regrid
   /home/z1l/bin/tools/transfer_to_mosaic_grid
</pre>

The user guide of each tool also could be obtained through running, <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;>$executable

      <p class="subtitle"><b>2. Check out the code (GFDL user only)</b></p>        
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        cvs co -r branch_name shared/mosaic tools
   

      <p class="subtitle"><b>3. compile the code to generate executable</b></p>      
        Find the make file fre-nctools.mk in directory tools/$subtool/ ($subtool
        is one of fregrid, make_coupler_mosaic, make_hgrid, make_solo_mosaic, make_topog,
        make_vgrid, make_regional_mosaic, check_mask, runoff_regrid, remap_land,
        river_regrid, transfer_to_mosaic_grid). Go to the subdirectory
        and configure the  Makefile.  Compilation will then produce the
        executable. No changes to the configuration are  needed if you plan to
        run on the GFDL analysis cluster.

      <p class="subtitle"><b>4. Example grid generation for coupled model</b></p>   
<pre>
    1) <b>generate C48 grid and solo mosaic for atmos model (cubed sphere with C48 resolution)</b>
       /home/z1l/bin/tools/make_hgrid --grid_type gnomonic_ed --nlon 96
       /home/z1l/bin/tools/make_solo_mosaic --num_tiles 6 --dir ./ --mosaic C48_mosaic

    2) <b>generate tripolar grid (similar to OM3) and mosaic for ocean model</b>
       /home/z1l/bin/tools/make_hgrid --grid_type tripolar_grid --nxbnd 2 --nybnd 7
         --xbnd -280,80 --ybnd -82,-30,-10,0,10,30,90 --nlon 720 --nlat 104,48,40,40,48,120
         --grid_name tripolar_grid --center c_cell
       /home/z1l/bin/tools/make_solo_mosaic --num_tiles 1 --dir ./ --mosaic tripolar_mosaic
         --tile_file tripolar_grid.nc --periodx 360

    3) <b>generate N45 grid and mosaic for land model</b>
       /home/z1l/bin/tools/make_hgrid --grid_type regular_lonlat_grid --nxbnd 2 --nybnd 2
         --xbnd 0,360 --ybnd -90,90 --nlon 288 --nlat 180 --grid_name N45_grid
       /home/z1l/bin/tools/make_solo_mosaic --num_tiles 1 --dir ./ --mosaic N45_mosaic
         --tile_file N45_grid.nc --periodx 360

    4) <b>generate topography for ocean mosaic</b>
       mpirun -np 10 /home/z1l/bin/tools/make_topog_parallel --mosaic ./tripolar_mosaic.nc
       --topog_file /archive/fms/mom4/input_data/OCCAM_p5degree.nc --topog_field TOPO
       --scale_factor -1 --output topog.nc

    5) <b>make exchange grid information between component model grids</b>
       mpirun -np 10 /home/z1l/bin/tools/make_coupler_mosaic_parallel --atmos_mosaic ./C48_mosaic.nc
         --land_mosaic ./N45_mosaic.nc --ocean_mosaic ./tripolar_mosaic.nc --ocean_topog ./topog.nc
</pre>

      <p class="subtitle"><b>5. example to generate torus grid for MOM solo</b></p>   
<pre>
    1) <b>create horizontal grid and solo mosaic</b>
       /home/z1l/bin/tools/make_hgrid --grid_type regular_lonlat_grid --nxbnd 2 --nybnd 2
         --xbnd 0,20 --ybnd 10,30 --dlon 1,1 --dlat 1,1 --grid_name ocean_hgrid
       /home/z1l/bin/tools/make_solo_mosaic --num_tiles 1 --dir ./ --mosaic_name ocean_mosaic
         --tile_file ocean_hgrid.nc --periodx 20 --periody 20

    2) <b>generate vertical grid</b>
       /home/z1l/bin/tools/make_vgrid --nbnds 2 --bnds 0.,200 --dbnds 10,10
         --grid_name ocean_vgrid 

    3) <b>generate topography for ocean mosaic.</b>
       /home/z1l/bin/tools/make_topog --mosaic ocean_mosaic.nc --topog_type rectangular_basin
         --bottom_depth 200
</pre>        

      <p class="subtitle"><b>6. example to generate box channel grid for MOM solo model</b></p>   
<pre>
    1) <b>create horizontal grid and solo mosaic</b>
       /home/z1l/bin/tools/make_hgrid --grid_type regular_lonlat_grid --nxbnd 2 --nybnd 2
         --xbnd 0,10 --ybnd -40,-10 --dlon 0.5,0.5 --dlat 0.5,0.5 --grid_name ocean_hgrid

       /home/z1l/bin/tools/make_solo_mosaic --num_tiles 1 --dir ./ --mosaic_name ocean_mosaic
         --tile_file ocean_hgrid.nc 

    2) <b>generate vertical grid</b>
       /home/z1l/bin/tools/make_vgrid  --nbnds 2 --bnds 0,1200 --dbnds 40,40 --grid_name ocean_vgrid 
         --grid_name ocean_vgrid 

    3) <b>generate topography for ocean mosaic.</b>
       /home/z1l/bin/tools/make_topog --mosaic ocean_mosaic.nc --topog_type box_channel
         --jwest_south 5 --jwest_north 15 --jeast_south 30 --jeast_north 45 --bottom_depth 1200
</pre>        

      <p class="subtitle"><b>7. example to generate bowl grid for MOM solo model</b></p>   
<pre>
    1) <b>create horizontal grid and solo mosaic</b>
       /home/z1l/bin/tools/make_hgrid --grid_type regular_lonlat_grid --nxbnd 2 --nybnd 2
         --xbnd 0,20 --ybnd 60,72 --dlon 0.5,0.5 --dlat 0.5,0.5 --grid_name ocean_hgrid

       /home/z1l/bin/tools/make_solo_mosaic --num_tiles 1 --dir ./ --mosaic_name ocean_mosaic
         --tile_file ocean_hgrid.nc 

    2) <b>generate vertical grid</b>
       /home/z1l/bin/tools/make_vgrid --nbnds 3 --bnds 0.,220.,5500. --dbnds 10.,10.,367.14286
         --center c_cell --grid_name ocean_vgrid 

    3) <b>generate topography for ocean mosaic.</b>
       /home/z1l/bin/tools/make_topog --mosaic ocean_mosaic.nc --topog_type bowl --bottom_depth 5500
</pre>        

      <p class="subtitle"><b>8. example to generate dome grid for MOM solo model</b></p>   
<pre>
    1) <b>create horizontal grid and solo mosaic</b>
       /home/z1l/bin/tools/make_hgrid --grid_type regular_lonlat_grid --nxbnd 2 --nybnd 2
         --xbnd 0,25 --ybnd 63,70 --dlon 0.5,0.5 --dlat 0.5,0.5 --grid_name ocean_hgrid

       /home/z1l/bin/tools/make_solo_mosaic --num_tiles 1 --dir ./ --mosaic_name ocean_mosaic
         --tile_file ocean_hgrid.nc 

    2) <b>generate vertical grid</b>
       /home/z1l/bin/tools/make_vgrid --nbnds 3 --bnds 0.,220.,5500. --dbnds 10.,10.,367.14286
         --center c_cell --grid_name ocean_vgrid 

    3) <b>generate topography for ocean mosaic.</b>
       /home/z1l/bin/tools/make_topog --mosaic ocean_mosaic.nc --topog_type bowl --bottom_depth 5500
</pre>        
        
      <p class="subtitle"><b>9. Use fregrid to remap data from C48
            onto N45 using second order conservative
            interpolation. Use parallel version for higher
            resolution.</b></p>
        <pre>
 /home/z1l/bin/tools/fregrid --input_mosaic ./C48_mosaic.nc --input_dir /home/z1l/bin/tools/test/input/
   --input_file 19800101.atmos_daily --scalar_field zsurf,temp,t_surf
   --output_mosaic ./N45_mosaic.nc --interp_method conserve_order2
   --output_file 19800101.atmos_daily.N45.order2 --check_conserve
</pre>
        
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title" style="clear: both"><a name=
            "fregrid"></a>fregrid</h2>
          </div>
        </div>
      </div>
<pre>
  fregrid --input_mosaic input_mosaic --input_file input_file                         
          [--scalar_field scalar_fld] [--u_field u_fld]  [--v_field v_fld]            
          [--output_mosaic output_mosaic] [--lonBegin #decimal] [--lonEnd #decimal]   
          [--latBegin #decimal] [--latEnd #decimal] [--nlon #integer]                 
          [--nlat #integer] [--KlevelBegin #integer] [--KlevelEnd #integer]           
          [--LstepBegin #integer] [--LstepEnd #integer]                               
          [--output_file output_file] [--input_dir input_dir]                         
          [--output_dir output_dir] [--remap_file remap_file]                         
          [--interp_method method] [--grid_type grid_type] [--test_case test_case]    
          [--symmetry] [--target_grid] [--finer_step #] [--fill_missing]              
          [--center_y] [--check_conserve] [--weight_file weight_file]                 
          [--weight_field --weight_field] [--dst_vgrid dst_vgrid]                     
          [--extrapolate] [--stop_crit #]                                             

fregrid remaps data (scalar or vector) from input_mosaic onto
output_mosaic.  Note that the target grid also could be specified
through lonBegin, lonEnd, latBegin, latEnd, nlon and nlat. Currently
only T-cell scalar regridding and AGRID vector regridding is
available.  Bilinear interpolation is implemented only for cubic grid
vector interpolation. The interpolation algorithm used is controlled
by --interp_method with default 'conserve_order1'. Currently the
'conserve_order1', 'conserve_order2' and 'bilinear' remapping schemes
are implemented. 'bilinear' is only used to remap data from cubic grid
to latlon grid. Alternative schemes can be added if needed. fregrid
expects NetCDF format input. scalar_field and/or u_field/v_field must
be specified. u_fld and v_fld must be paired together.
                                                                                      
fregrid takes the following flags:                                                    
                                                                                      
REQUIRED:                                                                             
                                                                                      
--input_mosaic  input_mosaic  specify the input mosaic information. This file         
                              contains list of tile files which specify the grid      
                              information for each tile.                              
                                                                                      
OPTIONAL FLAGS                                                                        
                                                                                      
--input_file    input_file    specify the input file name. The suffix '.nc' can be    
                              omitted. The suffix 'tile#' should not present for      
                              multiple-tile files. The number of files must be 1 for  
                              scalar regridding and can be 1 or 2 for vector          
                              regridding. File path should not be includes.           
                                                                                      
--scalar_field    scalar_fld  specify the scalar field name to be regridded. The      
                              multiple entry field names are seperated by comma.      
                                                                                      
--u_field         u_fld       specify the vector field u-componentname to be          
                              regridded. The multiple entry field names are seperated 
                              by comma. u_field must be paired together with v_field. 
                                                                                      
--v_field         v_fld       specify the vector field v-componentname to be          
                              regridded. The multiple entry field names are seperated 
                              by comma. v_field must be paired together with u_field. 
                                                                                      
--output_mosaic output_mosaic specify the output mosaic information. This file        
                              contains list of tile files which specify the grid      
                              information for each tile. If output_mosaic is not      
                              specified, nlon and nlat must be specified.             
                                                                                      
--lonBegin  #decimal          specify the starting longitude(in degree) of the        
                              geographical region of the target grid on which the     
                              output is desired. The default value is 0.              
                                                                                      
--lonEnd   #decimal           specify the ending longitude(in degree) of the          
                              geographical region of the target grid on which the     
                              output is desired. The default value is 360.            
                                                                                      
--latBegin  #decimal          specify the starting latitude(in degree) of the         
                              geographical region of the target grid on which the     
                              output is desired. The default value is -90.            
                                                                                      
--latEnd   #decimal           specify the ending latitude(in degree) of the           
                              geographical region of the target grid on which the     
                              output is desired. The default value is 90.             
                                                                                      
--nlon #integer               specify number of grid box cells in x-direction for a   
                              regular lat-lon grid.                                   
                                                                                      
--nlat #integer               specify number of grid box cells in y-direction for a   
                              regular lat-lon grid.                                   
                                                                                      
--KlevelBegin #integer        specify begin index of the k-level (depth axis) that    
                              to be regridded.                                        
                                                                                      
--KlevelEnd #integer          specify end index of the k-level (depth axis) that      
                              to be regridded.                                        
                                                                                      
--LstepBegin #integer         specify the begin index of L-step (time axis) that      
                              to be regridded.                                        
                                                                                      
--LstepEnd #integer           specify the end index of L-step (time axis) that        
                              to be regridded.                                        
                                                                                      
--output_file   output_file   specify the output file name. If not presented,         
                              output_file will take the value of input_file. The      
                              suffix '.nc' can be omitted. The suffix 'tile#' should  
                              not present for multiple-tile files. The number of      
                              files must be 1 for scalar regridding and can be 1 or 2 
                              for vector regridding. File path should not be includes.
                                                                                      
--input_dir     input_dir     specify the path that stores input_file. If not         
                              presented, the input file is assumed to be stored in    
                              current diretory.                                       
                                                                                      
--output_dir   output_dir     specify the path that will store output file. If not    
                              presented, the output file will be stored in current    
                              diretory.                                               
                                                                                      
--remap_file   remap_file     specify the file name that saves remapping information. 
                              If remap_file is specified and the file does not exist, 
                              remapping information will be calculated ans stored in  
                              remap_file. If remap_file is specified and the file     
                              exists, remapping information will be read from         
                              remap_file.                                             
                                                                                      
--interp_method interp_method specify the remapping algorithm to be used. Default is  
                              'conserve_order1'. Currently only 'conserve_order1',    
                              'conserve_order2' and 'bilinear' remapping scheme are   
                              implemented in this tool. The bilinear scheme can only  
                              be used to remap data from cubic grid to regular latlon 
                              grid. When interp_method is 'bilinear', nlon and nlat   
                              must be specified and the output data in y-direction    
                              will be located at the center of cell or bound of the   
                              cell depending on the setting of y_center.              
                                                                                      
--test_case test_case         specify the test function to be used for testing.       
                                                                                      
--grid_type     grid_type     specify the vector field grid location. default is      
                              AGRID and only AGRID is implemented yet.                
                                                                                      
--symmetry                    indicate the grid is symmetry or not.                   
                                                                                      
--target_grid                 use input cell area instead of calculating based on     
                              exchange grid area. default is off.                     
                                                                                      
---finer_step #integer        This is used only for bilinear interpolation. Set       
                              finer_step to a positive integer to reduce noise in     
                              interpolation and get a relatively smooth output. The   
                              default value is 0. When finer_step is greater than 0,  
                              fregrid will first remap data from source grid onto a   
                              finer grid with resolution that is power of 2 of        
                              destination grid resolution using bilinear              
                              interpolation, then using volume averaging to remap     
                              data from finer grid onto destination grid.             
                                                                                      
--center_y                    output latitude will locate at cell center, i.e., the   
                              starting latitude will be -89 when nlat = 90. when      
                              center_y is not set, starting latitude will be -90. for 
                              bilinear interpolation. For conservative interpolation, 
                              center_y is assumed.                                    
                                                                                      
--check_conserve              check the conservation of conservative interpolation.   
                              The area sum will be printed out for input and output   
                              mosaic.                                                 
                                                                                      
--weight_file                 Specify the filename that store weight_field. The       
                              suffix '.tile#.nc' should not present for multiple-tile 
                              files. weight_field is used to adjust the source weight.
                              Normally it could be area fraction. When weight_field   
                              is specified, the weight_file will default to be        
                              input_file if weight_file is not specified.             
                                                                                      
--weight_field                Specify the name of weight field in weight_file         
                                                                                      
--dst_vgrid                   specify the destination vertical grid file. Data will   
                              be remapped onto the destination vertical grid.         
                              When --dst_vgrid is specified, --extrapolate is         
                              assumed to be specified.                                
                                                                                      
--extrapolate                 Will extrapolate data onto masked points when specified.
                                                                                      
--stop_crit #                 The stopping criteria when extrapping data onto missing 
                              points. Default is 0.005                                
                                                                                      
  Example 1: Remap C48 data onto N45 grid.                                            
             (use GFDL-CM3 data as example)                                           
   fregrid --input_mosaic C48_mosaic.nc --input_dir input_dir --input_file input_file 
           --scalar_field temp,salt --nlon 144 --nlat 90                              
                                                                                      
  Example 2: Remap data onto cm2m ocean grid with extrapolation                       
             and vertical interpolation.                                              
   fregrid --input_mosaic levitus_mosaic.nc --input_dir inputdir                      
           --input_file WOA09_ann_theta.nc --scalar_field POTENTIAL_TEMP              
           --output_file WOA09_ann_theta_cm2g_extrap.nc                               
           --output_mosaic cm2m_ocean_mosaic.nc --extrapolate                         
           --dst_vgrid inputdir/cm2m_ocean_vgrid.nc                

         </pre> 
          

      <div class="titlepage">
        <div>
          <div>
            <h2 class="title" style="clear: both"><a name=
            "make_coupler_mosaic"></a>make_coupler_mosaic</h2>
          </div>
        </div>
      </div>
<pre>
  make_coupler_mosaic --atmos_mosaic atmos_mosaic.nc --ocean_mosaic ocean_mosaic.nc 
              --ocean_topog ocean_topog.nc [--land_mosaic land_mosaic.nc] [--wave_mosaic]
              [--sea_level #]  [--interp_method #] [--mosaic_name mosaic_name] 
              [--check ] [--verbose]                                              
 
make_coupler_mosaic generates three exchange grids for the FMS coupler. The output 
file includes exchange grid files for fluxes between atmosphere and surface (sea ice 
and land), exchange grid files for runoff between land and sea ice. There might be more 
than one exchange grid files between two model solo mosaic because there might be 
multiple tiles in a solo mosaic. The exchange grid information is between model 
grid, not between supergrid. We assume the refinement ratio between model grid and 
supergrid is 2. Currently we only output the exchange grid on T-cell. 

Besides generating the exchange grid files, make_coupler_mosaic also generates the 
coupler mosaic file (the file name will be mosaic_name.nc) which contains the atmos, 
land and ocean mosaic path, ocean mosaic topog path and exchange grid file path. 
make_coupler_mosaic expects NetCDF format input.
 
make_coupler_mosaic takes the following flags:

REQUIRED:

--atmos_mosaic atmos_mosaic.nc specify the atmosphere mosaic information. This file
                               contains list of tile files which specify the grid 
                               information for each tile. Each grid is required to be 
                               logically rectangular grid. The file name can not be 'mosaic.nc' 

--ocean_mosaic ocean_mosaic.nc specify the ocean mosaic information. This file
                               contains list of tile files which specify the grid 
                               information for each tile. The file name can not be 'mosaic.nc' 
 
--ocean_topog ocean_topog.nc   specify the topography information for ocean mosaic.
                               The field name of the topography is depth_tile# or depth when 
                               ntiles = 1, The topography data is positive down.
 
OPTIONAL FLAGS

--land_mosaic land_mosaic.nc   specify the land mosaic information. This file
                               contains list of tile files which specify the grid 
                               information for each tile. Each grid is required to be 
                               logically rectangular grid. When land_mosaic is not specified,
                               atmosphere mosaic will be used to specify land mosaic.
                               The file name can not be 'mosaic.nc'.
 
--wave_mosaic wave_mosaic.nc   specify the wave mosaic information. This file
                               contains list of tile files which specify the grid 
                               information for each tile. Each grid is required to be 
                               logically rectangular grid. When wave_mosaic is specified, 
                               exchange grid information between wave mosaic and ocean 
                               mosaic will be generated. Otherwise none of both will be created.
 
--interp_order #               specify the order of conservative interplation. Its value 
                               can be 1 ( linear order ) or 2 ( second order ) with default 
                               value 2.                                                     
                                                                                            
--sea_level #                  specify the sea level ( in meters ) and its value will be used
                               to determine land/sea mask. When topography of  
                               a grid cell is less than sea level, this grid cell will be land,
                               otherwise it will be ocean. Default value is 0
 
--mosaic_name mosaic_name      coupler mosaic name. The output coupler mosaic file will be 
                               mosaic_name.nc. default value is 'mosaic'. 
 
--check                        check the tiling error

--verbose                      Set --verbose to print out messages during running.        

A sample call to make_coupler_mosaic that makes exchange grids for atmosphere, land and ocean 
mosaic (atmosphere and land are coincident) is: 

  make_coupler_mosaic --atmos_mosaic atmos_mosaic.nc --ocean_mosaic ocean_mosaic.nc 
                  --ocean_topog ocean_topog.nc
</pre> 


      <div class="titlepage">
        <div>
          <div>
            <h2 class="title" style="clear: both"><a name=
            "make_hgrid"></a>make_hgrid</h2>
          </div>
        </div>
      </div>
<pre>
   make_hgrid --grid_type grid_type --my_grid_file my_grid_file                  
                  --nxbnds nxbnds --nybnds nybnds                                
                  --xbnds x(1),...,x(nxbnds) --ybnds y(1),...,y(nybnds)          
                  --nlon nlon(1),...nlon(nxbnds-1)                               
                  --nlat nlat(1),...nlat(nybnds-1)                               
                  --dlon dlon(1),...dlon(nxbnds)                                 
                  --dlat dlat(1),...dlat(nybnds)                                 
                  --lat_join lat_join --num_lon num_lon --nratio nratio          
                  --simple_dx simple_dx --simple_dy simple_dy                    
                  --grid_name gridname --center center --verbose --shift_fac #   
                  --do_schmidt --stretch_fac # --target_lon # --target_lat #     
                  --nest_grid --parent_tile # --refine_ratio # --halo #          
                  --istart_nest # --iend_nest # --jstart_nest # --jend_nest #    
                                                                                 
This program can generate different types of horizontal grid. The
output data is on supergrid ( model grid size x refinement(=2) ).  For
'cubic_grid', six grid files which contain the grid information for
each tile will be generate, otherwise one file will be generated you
can specify the grid type through --grid_type. The value of grid_type
can be 'from_file', 'spectral_grid', 'spherical_grid',
'conformal_cubic_grid', 'gnomonic_ed' or 'simple_cartesian_grid', with
default value 'spherical_grid'. --nlon and --nlat must be specified to
indicate supergrid size ( for cubic_grid, --nlat is not needed because
nlat has the same value as nlon.  Besides --nlon, --nlat, other
optional and requirement arguments for each type are,
                                                                                 
Two algorithms are provided for creating 'tripolar_grid' and
'regular_lonlat_grid'. Monotonic cubic interpolation and legacy
algorithm using cosine function to configure grid cell location.  The
monotonic cubic interpolation is developed by Russell Fiedler and the
detail of the alrogithm is explained in
http://www.mathworks.com/moler/interp.pdf. More details of the
algorithm is available in

F. N. Fritsch and R. E. Carlson, Monotone Piecewise Cubic
Interpolation, SIAM Journal on Numerical Analysis, 17 (1980),
pp. 238-246.
                                                                                 
D. Kahaner, C. Moler, and S. Nash, Numerical Methods and Software,
Prentice Hall, Englewood Cliffs, NJ, 1989.
	                               
 --nlon --nlat need to be specified to use the monotonic cubic
algorithm.  The legacy algorithm was developed by Ron Pacanowski. This
algorithm uses a cosine function to do the interpolation.

--dlon and --dlat need to be specified to use the legacy
algorithm. Monotonic cubic interpolation is a higher order
interpolation and will produce smoother grid distance. It is strongly
suggested to use the monotonic cubic interpolation by specifying
argument --nlon and --nlat.
                                                                                 
   1. 'from_file':              --my_grid_file must be specified. The grid    
                                specified in my_grid_file should be super grid   
                                vertex.                                          
   2. 'spectral_grid':          no other optional or required arguments.         
   3. 'regular_lonlat_grid':    --nxbnds, --nybnds --xbnds, --ybnds, must be     
                                specified to define the grid bounds.             
   4. 'tripolar_grid':          --nxbnds, --nybnds, --xbnds, --ybnds, must be    
                                specified to define the grid bounds. --lat_join  
                                is optional with default value 65.               
   5  'conformal_cubic_grid':   --nratio is optional argument.                   
   6  'gnomonic_ed'          :  equal distance gnomonic cubic grid.              
   7. 'simple_cartesian_grid':  --xbnds, --ybnds must be specified to define     
                                the grid bounds location and grid size. number   
                                of bounds must be 2 in both and x and            
                                y-direction. --simple_dx and --simple_dy must be 
                                specified to specify uniform cell length.        
   8  'f_plane_grid':           For setting geometric fractors according         
                                to f-plane. f_plane_latitude need to be specified
   9  'beta_plane_grid':        For setting geometric fractors according         
                                to  beta plane. f_plane_latitude need to be      
                                specified                                        
                                                                                 
   make_hgrid take the following flags                                           
                                                                                 
   --grid_type grid_type      specify type of topography. See above for          
                              grid type option.                                                                                                                   
   --my_grid_file file        when this flag is present, the program will read   
                              grid information from 'my_grid_file'. The file     
                              format can be ascii file or netcdf file. Multiple  
                              file entry are allowed but the number should be    
                              less than MAXBOUNDS.                                
                                                                                 
   --nxbnds nxbnds            Specify number of zonal regions for varying        
                              resolution.                                        
                                                                                 
   --nybnds nybnds            Specify number of meridinal regions for varying    
                              resolution.                                        
                                                                                 
   --xbnds x(1),.,x(nxbnds)   Specify boundaries for defining zonal regions of   
                              varying resolution. When --tripolar is present,    
                              x also defines the longitude of the two new poles. 
                              nxbnds must be 2 and lon_start = x(1),             
                              lon_end = x(nxbnds) are longitude of the two       
                              new poles.                                         
                                                                                 
   --ybnds y(1),.,y(nybnds)   Specify boundaries for defining meridional         
                              regions of varying resolution                      
                                                                                 
   --nlon nlon(1),..,nlon(nxbnds-1) Number of model grid points(supergrid) for   
                                    each zonal regions of varying resolution.    
                                                                                 
   --nlat nlat(1),..,nlat(nybnds-1) Number of model grid points(supergid) for    
                                    each meridinal regions of varying resolution.
                                                                                 
   --dlon dlon(1),..,dlon(nxbnds)   nominal resolution of zonal regions          
                                                                                 
   --dlat dlat(1),..,dlat(nybnds)   nominal resolution of meridional regions     
                                                                                 
   --lat_join lat_join        Specify latitude for joining spherical and rotated 
                              bipolar grid. Default value is 65 degree.          
                                                                                 
   --nratio nratio            Speicify the refinement ratio when calculating     
                              cell length and area of supergrid.                 
                                                                                 
   --simple_dx dimple_dx      Specify the uniform cell length in x-direction for 
                              simple cartesian grid.                             
                                                                                 
   --simple_dy dimple_dy      Specify the uniform cell length in y-direction for 
                              simple cartesian grid.                             
                                                                                 
   --grid_name grid_name      Specify the grid name. The output grid file name   
                              will be grid_name.nc if there is one tile and      
                              grid_name.tile#.nc if there is more than one tile. 
                              The default value will be horizontal_grid.         
                                                                                 
   --center center            Specify the center location of grid. The valid     
                              entry will be 'none', 't_cell' or 'c_cell' with    
                              default value 'none'. The grid refinement is       
                              assumed to be 2 in x and y-direction when center   
                              is not 'none'. 'c_cell' should be used for the grid
                              used in MOM4.                                      
                                                                                 
   --shift_fac                shift west by 180/shift_fac. Default value is 18.  
                                                                                 
   --do_schmidt               Set to do Schmidt transformation to create         
                              stretched grid. When do_schmidt is set, the        
                              following must be set: --stretch_factor,           
                              --target_lon and --target_lat.                     
                                                                                 
   --stretch_factor #         Stretching factor for the grid                     
                                                                                 
   --target_lon #             center longitude of the highest resolution tile    
                                                                                 
   --target_lat #             center latitude of the highest resolution tile     
                                                                                 
   --nest_grid                set to create nest grid as well as the global grid.
                              This option could only be set when grid_type is    
                              'gnomonic_ed'. When it is set, besides 6 tile grid 
                              files created, there is one more nest grid with    
                              file name = $grid_name.tile${parent_tile}.nest.nc  
                                                                                 
   --parent_tile #            Specify the parent tile number of nest grid.       
                                                                                 
   --refine_ratio #           Specify the refinement ratio for nest grid.        
                                                                                 
   --istart_nest #            Specify the starting i-direction index of nest     
                              grid in parent tile supergrid(Fortran index).      
                                                                                 
   --iend_nest #              Specify the ending i-direction index of nest       
                              grid in parent tile supergrid(Fortran index).      
                                                                                 
   --jstart_nest #            Specify the starting j-direction index of nest     
                              grid in parent tile supergrid(Fortran index).      
                                                                                 
   --jend_nest #              Specify the ending j-direction index of nest       
                              grid in parent tile supergrid(Fortran index).      
                                                                                 
   --halo #                   halo size to used in the atmosphere cubic sphere   
                              model. It only needs to be specified when          
                              --nest_grid is set.                                
                                                                                 
   --verbose                  Will print out running time message when this      
                              option is set. Otherwise the run will be silent    
                              when there is no error.                            
                                                                                 
   Example                                                                       
                                                                                 
                                                                                 
   1. generating regular lon-lat grid (supergrid size 60x20)                     
      > make_hgrid --grid_type regular_lonlat_grid --nxbnd 2 --nybnd 2           
        --xbnd 0,30 --ybnd 50,60  --nlon 60 --nlat 20                            
                                                                                 
   2. generating tripolar grid with various grid resolution and C-cell centered  
      using monotonic bi-cub spline interpolation.                               
      > make_hgrid --grid_type tripolar_grid --nxbnd 2 --nybnd 7 --xbnd -280,80  
                   --ybnd -82,-30,-10,0,10,30,90 --nlon 720                      
                   --nlat 104,48,40,40,48,120 --grid_name om3_grid               
                   --center c_cell                                               
                                                                                 
   3. generating tripolar grid with various grid resolution and C-cell centered  
      using legacy algorithm (create GFDL CM2/ocean-like grid)                   
      > make_hgrid --grid_type tripolar_grid --nxbnd 2 --nybnd 7 --xbnd -280,80  
                   --ybnd -82,-30,-10,0,10,30,90 --dlon 1.0,1.0                  
                   --dlat 1.0,1.0,0.6666667,0.3333333,0.6666667,1.0,1.0          
                   --grid_name om3_grid --center c_cell                          
                                                                                 
   4. generating simple cartesian grid(supergrid size 20x20)                     
      > make_hgrid --grid_type simple_cartesian_grid --xbnd 0,30 --ybnd 50,60    
                   --nlon 20 --nlat 20  --simple_dx 1000 --simple_dy 1000        
                                                                                 
   5. generating conformal cubic grid. (supergrid size 60x60 for each tile)      
      > make_hgrid --grid_type conformal_cubic_grid --nlon 60 --nratio 2         
                                                                                 
   6. generating gnomonic cubic grid with equal_dist_face_edge(C48 grid)         
      > make_hgrid --grid_type gnomonic_ed --nlon 96                             
                                                                                 
   7. generating gnomonic cubic streched grid.                                   
      > make_hgrid --grid_type gnomonic_ed --nlon 180 --do_schmidt               
                   --stretch_factor 3 --target_lat 40. --target_lon 20.          
                                                                                 
   8. generating spectral grid. (supergrid size 128x64)                          
      > make_hgrid --grid_type spectral_grid --nlon 128 --nlat 64                
                                                                                 
   9. Through    user-defined grids                                              
      > make_hgrid --grid_type from_file --my_grid_file my_grid_file             
                   --nlon 4 --nlat 4                                             
                                                                                 
       contents of sample my_grid_file                                           
         The first line of my_grid_file will be text ( will be ignored)          
         followed by nlon+1 lines of real value of x-direction supergrid bound   
         location. Then another line of text ( will be ignored), followed by     
         nlat+1 lines of real value of y-direction supergrid bound location.     
                                                                                 
         For example:                                                            
                                                                                 
            x-grid                                                               
            0.0                                                                  
            5.0                                                                  
            10.0                                                                 
            15.0                                                                 
            20.0                                                                 
            y-grid                                                               
            -10                                                                  
            10                                                                   
            20                                                                   
            30                                                                   
            40                                                                   
                                                                                 
   10. generating f_plane_grids                                                   
      > make_hgrid --grid_type f_plane_grid --f_plane_latitude 55 --nxbnd 2      
                   --nybnd 2 --xbnd 0,30 --ybnd 50,60  --nlon 60 --nlat 20       
                                                                                 
 A note on generating cyclic regular lon-lat grids when center = 'c_cell':-      
 It is possible to have an improperly centered boundary unless care is taken to  
 ensure local symmetry at the join.                                              
 A correctly formed grid is only guaranteed if the first three values of the     
 --xbnd argument mirror the last 3 and the first two 'nlon' arguments mirror the 
 last 2.                                                                         
                                                                                 
 For example for a global grid make_hgrid should be invoked as                   
       > make_hgrid --grid_type regular_lonlat_grid ...                          
                    --xbnd 0,X1,X2,...,360-X2,360-X1,360                         
                    --nlon N1,N2,...,N2,N1 --center c_cell                       
                                                                                 
 As an example                                                                   
                                                                                 
       > make_hgrid --grid_type regular_lonlat_grid --nxbnd 7 --nybnd 2          
                    --xbnd 0,15,30,300,330,345,360 --ybnd 50,60                  
                    --nlon 4,2,6,4,2,4 --nlat 2 --center c_cell                  
                                                                                 
                                                                                 
 results in a valid cyclic grid whereas (note the second last value of nlon)     
                                                                                 
       > make_hgrid --grid_type regular_lonlat_grid --nxbnd 7 --nybnd 2          
                    --xbnd 0,15,30,300,330,345,360 --ybnd 50,60                  
                    --nlon 4,2,6,4,4,4 --nlat 2 --center c_cell                  
                                                                                 
                                                                                 
 is not properly centered across 0,360                                           
                                                                                 
 An informational message is issued if the leftmost and rightmost  resolutions   
 differ  by more than 1 part in 10E6                                                                              


</pre> 


      <div class="titlepage">
        <div>
          <div>
            <h2 class="title" style="clear: both"><a name=
            "make_solo_mosaic"></a>make_solo_mosaic</h2>
          </div>
        </div>
      </div>
<pre>
 make_solo_mosaic --num_tiles ntiles --dir directory [--mosaic_name mosaic_name] 
                 [--tile_file tile_file] [--periodx #] [--periody #]             
                                                                                 
make_solo_mosaic generates Mosaic information between tiles. The mosaic          
information includes: list of tile files, list of contact region                 
specified by index, contact type.                                                
                                                                                 
make_solo_mosaic takes the following flags:                                      
                                                                                 
REQUIRED:                                                                        
                                                                                 
--num_tiles ntiles     Number of tiles in the mosaic.                            
                                                                                 
--dir directory        The directory that contains all the tile grid file.       
                                                                                 
OPTIONAL FLAGS                                                                   
                                                                                 
--mosaic_name name     mosaic name. The output file will be mosaic_name.nc.      
                       default is 'mosaic'.                                      
                                                                                 
--tile_file tile_file  Grid file name of all tiles in the mosaic. The file name  
                       should be relative file name ( exclude the absolute       
                       file path). The absolute file path will be dir/tile_file. 
                       If this option is not specified, the tile_file will be    
                       'horizontal_grid.tile#.nc'                                
                                                                                 
--periodx #             Specify the period in x-direction of mosaic. Default     
                        value is 0 (not periodic).                               
                                                                                 
--periody #             Specify the period in y-direction of mosaic. Default     
                        value is 0 (not periodic).                               
                                                                                 
 Example 1: create solo mosaic for tripolar grid(grid file name is ocean_grid.nc.
   make_solo_mosaic --num_tiles 1 --dir ./ --mosaic_name ocean_mosaic            
                     --tile_file ocean_hgrid.nc --periodx 360                    
                                                                                 
 Example 2: create solo mosaic for torus.                                        
   make_solo_mosaic --num_tiles 1 --dir ./ --mosaic_name ocean_mosaic            
                    --tile_file ocean_hgrid.nc --periodx 360 --periody 360       
                                                                                 
 Example 3: create solo mosaic for C48 grid.                                     
   make_solo_mosaic --num_tiles 6 --dir ./ --mosaic C48_mosaic --tile_file       
   C48_grid.tile1.nc,C48_grid.tile2.nc,C48_grid.tile3.nc,C48_grid.tile4.nc,      
   C48_grid.tile5.nc,C48_grid.tile6.nc                                   
</pre>


      <div class="titlepage">
        <div>
          <div>
            <h2 class="title" style="clear: both"><a name=
            "make_topog"></a>make_topog</h2>
          </div>
        </div>
      </div>
<pre>
   make_topog --mosaic mosaic_file [--topog_type topog_type]  [x_refine #] [y_refine #]  
              [--bottom_depth #] [--min_depth #]                                         
              [--topog_file topog_file]  [--topog_field topog_field]                     
              [--scale_factor #] [--num_filter_pass #] [--gauss_amp #]                   
              [--gauss_scale #] [--slope_x #] [--slope_y #] [--bowl_south #]             
              [--bowl_north #] [--bowl_west #] [--bowl_east #]                           
              [--fill_first_row] [--filter_topog] [--round_shallow]                      
              [--fill_shallow] [--deepen_shallow] [--smooth_topo_allow_deepening]        
              [--dome_slope #] [--dome_bottom #], [--dome_embayment_west #]              
              [--dome_embayment_east # [--dome_embayment_south #]                        
              [--dome_embayment_depth #] [--vgrid_file vgrid_file]                       
              [--flat_bottom] [--full_cell] [--fill_isolated_cells #]                    
              [--dont_change_landmask] [--kmt_min #] [--dont_adjust_topo ]               
              [--fraction_full_cell #] [--dont_open_very_this_cell ] [--min_thickness #] 
              [--output output_file [--help] [--verbose]                                 
                                                                                         
   make_topog can generate topography for any Mosaic. The output file                    
   will contains the topography for each tile in the Mosaic. The field name in           
   the output topography file will be depth_tile# and it is positive down.               
   The topography data will be defined on model grid, the model grid size will be        
   supergrid grid size divided by refinement (x_refine, y_refine, default is 2).         
   --mosaic is a required option and all other options are optional, but                 
   some options are required depending on the choice of topog_type.                      
   Below specify the option (required or non-required) needed for every kind             
   of topog_type. when topog_type (--topog_type) is                                      
                                                                                         
     1. 'realistic':          Remap the topography onto the current grid from some       
                              source data file.                                          
                              --topog_file and --topog_field must be specified,          
                              --min_depth, --scale_factor,                               
                              --num_filter_pass, --flat_bottom                           
                              --fill_first_row  --filter_topog                           
                              --round_shallow] --fill_shallow --deepen_shallow]          
                              --smooth_topo_allow_deepening --vgrid_file                 
                              --full_cell --dont_fill_isolated_cells                     
                              --dont_change_landmask --kmt_min  --dont_adjust_topo       
                              --fraction_full_cell --dont_open_very_this_cell            
                              --min_thickness  are optional arguments.                   
                                                                                         
     2.  'rectangular_basin': Constructing a rectangular basin with a flat bottom.       
                              --bottome_depth are optional arguments. Set bottom_depth   
                              to 0 to get all land topography.                           
                                                                                         
     3.  'gaussian':          Construct gaussian bump on a sloping bottom.               
                              --bottom_depth, --min_depth --gauss_amp, --gauss_scale,    
                              --slope_x, --slope_y are optional arguments.               
                                                                                         
     4.. 'bowl':              --bottom_depth, --min_depth, --bowl_south, --bowl_north,   
                              --bowl_west, --bowl_east are optional arguments.           
                                                                                         
     5. 'idealized':          Generates an 'idealized' not very realistic topography.    
                              --bottom_depth, --min_depth are optional arguments.        
                                                                                         
     6. 'box_channel':        Generate a box_channel topography. The interiol of the     
                              grid box is a flot bottom. The boundary of the grid        
                              box is land except points [jwest_south:jwest_north]        
                              and [ieast_south:ieast_north]. --jwest_south, jwest_north, 
                              --ieast_south and ieast_north need to be specified.        
                              --bottom_depth are optional arguments.                     
                                                                                         
     7. 'dome':               similar (not identical) to DOME configuration of           
                              Legg etal Ocean Modelling (2005).  --dome_slope,           
                              --dome_bottom, --dome_embayment_west,                      
                              --dome_embayment_east, --dome_embayment_south and          
                              --dome_embayment_depth are optional arguments.             
                                                                                         
   generate_mosaic_topo take the following flags                                         
                                                                                         
   --mosaic mosaic_file          Specify the mosaic file where topography data located.  
                                                                                         
   --topog_type topog_type       Specify type of topography. Its value can be            
                                 'realistic', 'rectangular_basin', 'gaussian', 'bowl'    
                                 or 'idealized'. The default value is 'realistic'.       
                                                                                         
   --x_refine #                  specify the refinement ratio of model grid vs supergrid 
                                 ins x-directin. default value 2.                        
                                                                                         
   --y_refine #                  specify the refinement ratio of model grid vs supergrid 
                                 ins y-directin. default value 2.                        
                                                                                         
   --topog_file topog_file       Specify name of topograhy file (e.g. scripps,           
                                 navy_topo, ...)                                         
                                                                                         
   --topog_field topog_field     Specify name of topography field name in topog_file.    
                                                                                         
   --bottom_depth #              Specify maximum depth (or bottom depth) of ocean.       
                                 default value is 5000 meter.                            
                                                                                         
   --min_depth #                 Specify minimum depth of ocean.                         
                                 default value is 10 meter.                              
                                                                                         
   --scale_factor #              Specify scaling factor for topography data (e.g. -1 to  
                                 flip sign or 0.01 to convert from centimeters).         
                                 default value is 1.                                     
                                                                                         
   --num_filter_pass #           Specify number of passes of spatial filter              
                                 default value is 1.                                     
                                                                                         
   --gauss_amp #                 specify height of gaussian bump as percentage of ocean  
                                 depth. default value is 0.5.                            
                                                                                         
   --gauss_scale #               Specify width of gaussian bump as percentag e of        
                                 basin width. Default value is 0.25.                     
                                                                                         
   --slope_x #                   Specify rise of the ocean floor to the east for         
                                 the gaussian bump. Default value is 0.                  
                                                                                         
   --slope_y #                   Specify rise of the ocean floor to the north for        
                                 the gaussian bump. Default value is 0.                  
                                                                                         
   --bowl_south #                Specify southern boundary of Winton bowl.               
                                 Default value is 60.                                    
                                                                                         
   --bowl_north #                Specify northern boundary of Winton bowl.               
                                 Default value is 70.                                    
                                                                                         
   --bowl_west #                 Specify western boundary of Winton bowl.                
                                 Default value is 0.                                     
                                                                                         
   --bowl_east #                 Specify eastern boundary of Winton bowl.                
                                 Default value is 20.                                    
                                                                                         
   --fill_first_row              when specified, make first row of ocean model all       
                                 land points for ice model.                              
                                                                                         
   --filter_topog                When specified, apply filter to topography.             
                                                                                         
   --round_shallow               When specified, Make cells land if depth is less        
                                 than 1/2 mimumim depth, otherwise make ocean.           
                                                                                         
   --fill_shallow                When specified, Make cells less than minimum            
                                 depth land.                                             
                                                                                         
   --deepen_shallow              When specified, Make cells less than minimum            
                                 depth equal to minimum depth.                           
                                                                                         
   --smooth_topo_allow_deepening when specified, allow filter to deepen cells.           
                                                                                         
   --output output_file          The created netcdf file that contains mosaic            
                                 topography. Default value is 'topog.nc'                 
                                                                                         
   --jwest_south #               Specify the starting j-index on the west boundary of    
                                 the box channel.                                        
                                                                                         
   --jwest_north #               Specify the ending j-index on the west boundary of      
                                 the box channel.                                        
                                                                                         
   --jeast_south #               Specify the starting j-index on the east boundary of    
                                 the box channel.                                        
                                                                                         
   --jeast_north #               Specify the ending j-index on the east boundary of      
                                 the box channel.                                        
                                                                                         
   --dome_slope #                Slope for the dome configuration.  Default = 0.01       
                                                                                         
   --dome_bottom #               Bottom of the dome configuration.  Default=3600.0       
                                                                                         
   --dome_embayment_west #       western edge of dome embayment. Default=19.0            
                                                                                         
   --dome_embayment_east #       eastern edge of dome embayment. Default=21.0            
                                                                                         
   --dome_embayment_south #      southern edge of dome embayment. Default=69.0           
                                                                                         
   --dome_embayment_depth #      Depth of the embayment. Default=600.0                   
                                                                                         
   --vgrid_file vgrid_file       Specify the vertical grid file. When vgrid_file is      
                                 specified, number of levels will be written out and     
                                 topography could be ajusted when set --dont_adjust_topo(
                                 remove_isolated_cells, restrict_partial_cells and       
                                 enforce_min_depth ) is not set.                         
                                                                                         
   --flat_bottom                 generate flat bottom over ocean points when specified.  
                                                                                         
   --full_cell                   do not generate partial bottom cells when specified     
                                                                                         
   --dont_fill_isolated_cells    Do not allow non-advective tracer cells (strongly       
                                 recommended) when it is not set.                        
                                                                                         
   --dont_change_landmask        Do not change land/sea mask when filling isolated cells 
                                 when specified                                          
                                                                                         
   --kmt_min #                   minimum number of vertical levels. default = 2          
                                                                                         
   --dont_adjust_topo            Topography will not be adjusted when it is set. When    
                                 it is not set, adjust topography                        
                                 (enforce_min_depth, remove_isolated_cells,              
                                 restrict_partial_cells). Strongly recommend not setting 
                                 this option                                             
                                                                                         
   --fraction_full_cell #        Fraction of the associated full cell that a             
                                 corresponding partial cell thickness is no smaller than.
                                 That is, we maintain partial_cell_min_dht(i,j,k) =      
                                 fraction_full_cell*full_cell_dzt(k). If                 
                                 fraction_full_cell=0.0, then partial_cell_min_dht       
                                 = min(zw(1), 50.0). default is 0.2.                     
                                                                                         
   --dont_open_very_this_cell    When it is not set, check which change is larger,       
                                 opening or closing the cell, and to do that with smaller
                                 effect in depth_t.                                      
                                                                                         
   --min_thickness #             inimum vertical thickness allowed. with default value   
                                 0.1. Increase or decrease this number as needed.        
                                                                                         
   --help                        Print out this message and then exit.                   
                                                                                         
   --verbose                     Will print out running time message when this           
                                 option is set. Otherwise the run will be silent         
                                 when there is no error.                                 
   Example                                                                               
                                                                                         
   1. Generate 'realistic' topography                                                    
   > make_topog --mosaic mosaic.nc --topog_type realistic                                
                           --topog_file /archive/fms/mom4/input_data/OCCAM_p5degree.nc   
                           --topog_field TOPO --scale_factor -1                          
                                                                                         
   2. Generate 'rectangular_basin' topography (with uniform topography 200 meters).      
   > make_topog --mosaic mosaic.nc --topog_type  rectangular_basin                       
                           --bottome_depth 200                                           
                                                                                         
   3. Generate 'box_channel' topography (with flat bottom topography 5000 meters).       
   > make_topog --mosaic mosaic.nc --topog_type  box_channel --jwest_south 20            
                --jwest_north 40 --jeast_south 30 --jeast_north 60 --bottom_depth 5000   
                                                                                         
   4. Generate 'bowl' topography                                                         
     make_topog --mosaic ocean_mosaic.nc --topog_type bowl --bottom_depth 5500           
                                                                                         
   5. Generate 'dome' topography                                                         
     make_topog --mosaic ocean_mosaic.nc --topog_type dome --dome_slope 0.01             
                --dome_embayment_south 69 --dome_embayment_west 19.25                    
                --dome_embayment_east 21.25 --dome_bottom 5500                           
                               
        
</pre>

      <div class="titlepage">
        <div>
          <div>
            <h2 class="title" style="clear: both"><a name=
            "make_vgrid"></a>make_vgrid</h2>
          </div>
        </div>
      </div>
<pre>
   make_vgrid --nbnds nbnds --bnds z(1),...,z(nbnds) [--nz nz(1),...,nz(nbnds-1)]
              [--dbnds dbnds(1), ...,dbnds(nbnds)] [--stretch stretch]           
              [--grid_name gridname]    [--center center]                        
                                                                                 
make_vgrid is used to make a vertical grid for an FMS model.  It uses
a piecewise monotonic shape preserving cubic-spline algorithm to
calculate the grid cell location.  The output netcdf file contains
information on the  supergrid with grid size equal to the model grid size
multiplied by a refinement factor of two.

make_vgrid takes the following flags
                                                                                 
Two algorithms are provided for creating vertical grid: Monotonic
cubic interpolation and legacy algorithm using cosine function to
configure grid cell location. The monotonic cubic interpolation is
developed by Russell Fiedler and the detail of the alrogithm is
explained in

http://www.mathworks.com/moler/interp.pdf. More details of the
algorithm is available in F. N. Fritsch and R. E. Carlson, Monotone
Piecewise Cubic Interpolation, SIAM Journal on Numerical Analysis, 17
(1980), pp. 238-246.
                                                                                 
D. Kahaner, C. Moler, and S. Nash, Numerical Methods and Software,   
Prentice{Hall, Englewood Cliffs, NJ, 1989.                           

 --nz needs to be specified to use the monotonic cubic algorithm.  The
legacy algorithm is developed by Ron Pacanowski, and this older
algorithm uses cosine function to do the interpolation. --dbnds needs
to be specified to use the legacy algorithm. Since monotonic cubic
interpolation is a higher order interpolation, it will produce
smoother grid distance. It is strongly suggested to use the monotonic
cubic interpolation by specifying argument --nz.
                                                                                 
   Required Flags:                                                               
                                                                                 
   --nbnds nbnds             Specify number of vertical regions for varying      
                             resolution.                                         
                                                                                 
   --bnds z(1),.,z(nbnds)    Specify boundaries for defining vertical regions of 
                             varying resolution.                                 
                                                                                 
   Optional Flags:                                                               
                                                                                 
   --nz nz(1),..,nz(nbnds-1) Number of supergrid points (double number of        
                             model grid points) for each vertical                
                             regions of varying resolution.                      
                                                                                 
 --dbnds dbnds(1),.,dbnds(nbnds) nominal resolution of depth regions             
                                                                                 
 --stretch stretch           stretching factor for last region.                  
                             Default is 1 (no stretching)                        
                                                                                 
 --grid_name gridname        Specify the grid name. The output grid file name    
                             will be grid_name.nc. The default value is          
                             vertical_grid.                                      
                                                                                 
 --center   center           Specify the center location of grid. The valid      
                             entry will be 'none', 't_cell' or 'c_cell' with     
                             default value 'none'. The grid refinement is        
                             assumed to be 2 in x and y-direction when center    
                             is not 'none'. 'c_cell' should be used for the grid 
                             used in MOM .                                       
                                                                                 
                                                                                 
   Example 1: Use Monotonic cubic spline interpolation                           
                                                                                 
     make_vgrid --nbnds 3 --bnds 10,200,1000 --nz 10,20                          
       will make a grid file with 60 supergrid cells, 30 model grid cells        
       with refinement is 2.                                                     
                                                                                 
 In order to generate regions of constant resolution the user should specify 3   
 consecutive regions of constant resolution (only 2 for the first and last regions
 are required)                                                                   
                                                                                 
 make_vgrid --nbnds 4 --bnds 0,180,200,5000 --nz 18,2,30 --center c_cell         
 will have constant resolution in the top 200m                                   
                                                                                 
 make_vgrid --nbnds 6 --bnds 0,100,120,200,220,5000 --nz 20,2,8,2,30  --center c_cell  
 will have constant resolution from 120m-200m                                    
                                                                                 
                                                                                 
   Example 2: Use legacy algorithm                                               
                                                                                 
    make_vgrid --nbnds 3 --bnds 0.,220.,5500. --dbnds 10.,10.,367.14286          
               --center c_cell                                                   
      Will make a vertical grid similar to GFDL/CM2/ocn w/ 100 supergrid cells.                                        
        
</pre>         

       <div class="titlepage">
        <div>
          <div>
            <h2 class="title" style="clear: both"><a name=
            "check_mask"></a>check_mask</h2>
          </div>
        </div>          
      </div>

        
<pre>
 check_mask --grid_file grid_file [--ocean_topog topog_file] [--min_pe #] [--max_pe #]  
            [--halo #] [--sea_level #] [--show_valid_only] [--have_obc]                 
            [--direction d(1)..,d(nobc)] [--is is(1)...,is(nobc)]                       
            [--ie ie(1)...,ie(nobc)], [--js js(1)...,js(nobc)], [--je je(1)...,je(nobc)]
                                                                                        
 check_mask is used to configure the processors which contains all land points to be    
 masked out. This program is supposed to run on single processor. This tool will print  
 out number of processors to be masked, layout of the domain, masked out processors     
 list. These information will be written into files, with file name is                  
 mask_table.n_mask.layout(1)Xlayout(2). The model is expected to read file mask_table   
 if you want to mask out some processors.                                               
                                                                                        
 The purpose of using mask domain is to decrease the processor usage without            
 decreasing the performance, without changing bits relative to the case run without the 
 mask domain option. The mask domain option acts to mask out regions that have zero     
 ocean points (i.e., points that are all land) in both the ocean and sea ice models.    
                                                                                        
 check_mask takes the following flags:                                                  
                                                                                        
REQUIRED:                                                                               
                                                                                        
 --grid_file grid_file    Specify the grid file to be used in the model run. The        
                          grid_file could be old version of grid (contains field wet)   
                          or the new version mosaic grid, which contains field gridfiles
                          When grid_file is mosaic grid, it should be the ocean solo    
                          mosaic and ocean_topog file needs to be specified.            
                                                                                        
 OPTIONAL FLAGS                                                                         
                                                                                        
 --ocean_topog topog_file Specify the topography information for ocean mosaic.          
                          The field name of the topography is depth_tile# or depth      
                          when ntiles = 1, The topography data is positive down.        
                                                                                        
 --min_pe #               Specify the smallest processor count to be checked            
                                                                                        
 --max_pe #               Specify the largest processor count to be checked             
                                                                                        
 --halo #                 Specify the halo size in the ocean model. When there is no    
                          ocean points on a processor (including halo data), the        
                          processor will be masked out. Default value is 1.             
                                                                                        
 --sea_level #            Specify the sea level ( in meters ) and its value will be used
                          to determine land/sea mask. When topography of a grid cell    
                          is less than sea level, this grid cell will be land,          
                          otherwise it will be ocean. Default value is 0                
                                                                                        
 --show_valid_only        When set, only layouts valid with OBC are shown.              
                                                                                        
 --nobc #                 number of open boundary condition. Its value should be less   
                          than MAX_OBC (current is 4 ). default vaule is 0 for nobc.    
                                                                                        
 --direction d(1)..,d(nobc) open boundary direction. Each element value should be west, 
                            east, south or north.                                       
                                                                                        
 --is is(1)...,is(nobc)   starting i-index for open boundary condition. The index is    
                          Fortran index.                                                
                                                                                        
 --ie ie(1)...,ie(nobc)   ending i-index for open boundary condition. The index is      
                          Fortran index.                                                
                                                                                        
 --js js(1)...,js(nobc)   starting j-index for open boundary condition. The index is    
                          Fortran index.                                                
                                                                                        
 --je je(1)...,je(nobc)   ending i-index for open boundary condition. The index is      
                          Fortran index.                                                
                                                                                        
 Example 1: use mask domain in fully coupled model                                      
                                                                                        
  1. check_mask --grid_file /archive/z1l/tools/input/cm2m_grid/ocean_mosaic.nc          
                --ocean_topog /archive/z1l/tools/input/cm2m_grid/topog.nc               
                --min_pe 100 --max_pe 200                                               
     This will create a list of mask_table with filename                                
     mask_table.n_mask.layout(1)Xlayout(2). For example mask_table.9.18x10 has          
     layout=(18,10) and 9 domain processor is masked out. For the step 2, 3 and 4 we    
     use mask_table.9.18x10 as the example                                              
  2. copy mask_table.9.18x10 into 'INPUT' under working directory.                      
  3. set ocean_model_nml layout = 18,10                                                 
         ocean_model_nml mask_table = 'INPUT/mask_table.9.18x10'                        
  4. For concurrent run, set coupler_nml ocean_npes = 171 (18x10-9)                     
                                                                                        
  NOTE: For coupled models using concurrent coupling, you may only wish to set          
        ocean_model_nml variable mask_table, and not set ice_model_nml mask_table.      
        The reason for avoiding the ice_model use of mask_table with fully coupled      
        models is that,                                                                 
        1. the mask_table for the sea ice may not be necessary for performance          
           enhancement in fully coupled models                                          
        2. most importantly, setting mask_table for sea ice complicates the layout      
           for the ice model in fully coupled models.                                   
                                                                                        
 Example 2: use mask domain in sea-ice model ( baltic1 experiment, ocean, ice,          
            atmosphere and land are all on the same grid )                              
  1. check_mask --grid_file /archive/z1l/tools/input/baltic1_grid_spec.nc               
                 --min_pe 60 --max_pe 80                                                
     This will create a list of mask_table with filename                                
     mask_table.n_mask.layout(1)Xlayout(2). For example mask_table.26.6x11 has          
     layout=(6,11) and 26 domain processor is masked out. For the step 2 and 3 we       
     use mask_table.26.6x11 as the example                                              
                                                                                        
  2.  copy mask_table.26.6x11    into 'INPUT' under working directory.                  
  3.  set ocean_model_nml layout = 6,11                                                 
          ocean_model_nml mask_table = 'INPUT/mask_table.26.6x11                        
          ice_model_nml layout = 6,11                                                   
          ice_model_nml mask_table = 'INPUT/mask_table.26.6x11                          
          atmos_model_nml layout = 6,11                                                 
          atmos_model_nml mask_table = 'INPUT/mask_table.26.6x11                        
          land_model_nml layout = 6,11                                                  
          land_model_nml mask_table = 'INPUT/mask_table.26.6x11                         
   This experiment will run on 40 (6x11-26) processors.                                 


       
</pre>        
        

       <div class="titlepage">
        <div>
          <div>
            <h2 class="title" style="clear: both"><a name=
            "runoff_regrid"></a>runoff_regrid</h2>
          </div>
        </div>          
      </div>

        
<pre>

  runoff_regrid --input_file input_file --input_fld_name input_fld_name        
                --output_mosaic output_mosaic --output_topog output_topog      
                [--output_file output_file [--output_fid_name output_fid_name] 
                                                                               
runoff_regrid expects to read runoff data from a netcdf file, which is         
specfied by option --input_file. The name of the runoff field in input         
file is specified by option --input_fld_name. The output file is a netcdf      
file specified by opiton --output_fld_file. The name of the runoff field       
in output file is specified by option output_fld_name. The output grid         
is specified by optoin --output_mosaic. The output grid topography is          
specified by option --output_topog output_topog. This tool only supports       
mosaic version grid. If there is any land point has runoff data after          
remapping runoff data onto destination grid, the runoff value of that          
land point will be moved to the nearest ocean point.                           
                                                                               
runoff_regrid takes the following flags:                                       
                                                                               
REQUIRED:                                                                      
                                                                               
 --input_file                      specify the input file name.                
                                                                               
 --input_fld_name                  specify name of runoff field in input file. 
                                                                               
 --output_mosaic output_mosaic     specify the output mosaic information. This 
                                   file contains list of tile files which      
                                   specify the grid information for each tile. 
                                                                               
 --output_topog output_topog       specify the file name that contains output  
                                   grid topography information.                
                                                                               
                                                                               
OPTIONAL FLAGS                                                                 
                                                                               
 --output_file output_file         specify the output file name. The default   
                                   value is runff.nc.                          
                                                                               
 --output_fid_name output_fid_name specify name of runoff field in output file,
                                   The default value is runoff                 
                                                                               
                                                                               
example                                                                        

  runoff_regrid --input_file /archive/z1l/tools/input/runoff.daitren.iaf.10FEB2011.nc
                --input_fld_name runoff --output_mosaic                        
                /archive/z1l/tools/input/cm2m_grid/cm2m_ocean_mosaic.nc        
                --output_topog /archive/z1l/tools/input/cm2m_grid/cm2m_ocean_topog.nc 
                --output_file runoff.cm2m.nc

</pre>        

        
       <div class="titlepage">
        <div>
          <div>
            <h2 class="title" style="clear: both"><a name=
            "remap_land"></a>remap_land</h2>
          </div>
        </div>          
      </div>

        
<pre>
   remap_land --src_mosaic src_mosaic --src_restart src_restart                 
              --dst_mosaic dst_msoaic --dst_restart dst_restart                 
              --dst_cold_restart dst_cold_restart [--remap_file remap_file]     
                                                                                
 remap_land remap land restart file from one mosaic grid to another mosaic grid 
 remap_land takes the following flags,                                          
                                                                                
 REQUIRED:                                                                      
                                                                                
 --src_mosaic src_mosaic    specify the source mosaic information. This file    
                            contains list of tile files which specify the grid  
                            information for each tile.                          
                                                                                
 --dst_mosaic dst_mosaic    specify the destination mosaic information. This    
                            file contains list of tile files which specify the  
                            grid information for each tile.                     
                                                                                
 --src_restart src_restart  specify the source restart file.                    
                                                                                
 --dst_restart dst_restart  specify the restart file to be generated on         
                            destination grid.                                   
                                                                                
 --dst_cold_restart file    specify the cold restart file destination grid.     
                            This is the input file. The dst_cold_restart_file   
                            could be obtained by running the experiment         
                            for 1 day with --dst_mosaic using cold restart.     
                                                                                
                                                                                
 OPTIONAL FLAGS                                                                 
                                                                                
                                                                                
 --remap_file remap_file    specify the file name that saves remapping          
                            information. If remap_file is specified and the     
                            file does not exist, remapping information will be  
                            calculated and stored in remap_file. If remap_file  
                            is specified and the file exists, remapping         
                            information will be read from remap_file.           
                                                                                
                                                                                
 Example: remap land restart from C48 grid onto C180 grid.                      
                                                                                
   remap_land --src_mosaic /archive/z1l/tools/input/C48/C48_mosaic.nc           
              --dst_mosaic /archive/z1l/tools/input//C180/C180_mosaic.nc        
              --src_restart /archive/z1l/tools/input/land_src_restart/soil.res  
              --dst_cold_restart /archive/z1l/tools/input/land_dst_cold_restart/soil.res 
              --dst_restart soil.res                                            

</pre>        
        
       <div class="titlepage">
        <div>
          <div>
            <h2 class="title" style="clear: both"><a name=
            "river_regrid"></a>river_regrid</h2>
          </div>
        </div>          
      </div>

        
<pre>
  river_regrid --mosaic mosaic_grid --river_src river_src_file [--output output_file] 
              [--land_thresh land_thresh]                                             
                                                                                      
river_regrid will remap river network data from global regular lat-lon grid onto any  
other grid (includes regular lat-lon grid and cubic grid ), which is specified        
through option --mosaic. The river network source data is specified through option    
--river_src.                                                                          
                                                                                      
river_regrid takes the following flags:                                               
                                                                                      
REQUIRED:                                                                             
                                                                                      
--mosaic    mosaic_grid     specify the mosaic file of destination grid. This mosaic  
                            file should be a coupler mosaic file, which contains link 
                            to land solo mosaic and the exchange grid file.           
                                                                                      
--river_src river_src_file  specify the river network source data file. The data is   
                            assumed on regular lat-lon grid and the longitude is      
                            assumed from 0 to 360 degree and latitude is assumed      
                            from -90 to 90 degree.                                    
                                                                                      
OPTIONAL FLAGS                                                                        
                                                                                      
--output output_file        specify the output file base name. the suffix '.nc'       
                            should not be included in the output_file. The default    
                            value is river_output. For one tile mosaic, the actual    
                            result will be $output_file.nc. For multiple tile mosaic, 
                            the result will be $output.tile#.nc.                      
--land_thresh land_thresh   Any grid cell with land fraction greater than land_thresh 
                            will be land points, otherwise is a ocean cell. Default   
                            value is 0                                                
       
</pre>        

       <div class="titlepage">
        <div>
          <div>
            <h2 class="title" style="clear: both"><a name=
            "make_regional_mosaic"></a>make_regional_mosaic</h2>
          </div>
        </div>          
      </div>

 <pre>
        make_regional_mosaic --global_mosaic global_mosaic --regional_file regional_file 
                                                                                    
   NOTE: This program can generate horizontal grid and solo mosaic for a regional   
         output. The created grid and solo mosaic could be used to regrid regional output data
         onto regular lat-lon grid.

   make_regional_mosaic take the following flags                                    
                                                                                    
   --global_mosaic global_mosaic Specify the mosaic file for the global grid.       
                                                                                    
   --regional_file regional_file Specify the regional model output file.            
                                                                                    
   Example                                                                          
                                                                                    
      make_regional_mosaic --global_mosaic C48_mosaic.nc --regional_file            
                           rregionatmos_4xdaily.tile1.nc                      

</pre>
        
       <div class="titlepage">
        <div>
          <div>
            <h2 class="title" style="clear: both"><a name=
            "transfer_to_mosaic_grid"></a>transfer_to_mosaic_grid</h2>
          </div>
        </div>          
      </div>

        
<pre>
 transfer_to_mosaic_grid --input_file input_file                             
                                                                             
 transfer_to_mosaic_grid transfers previous version grid file (The grid file 
 has field x_T.y_T ) into a mosaic grid. The input file could be a ocean     
 only grid or a coupled grid.                                                
                                                                             
 transfer_to_mosaic_grid takes the following flags:                          
                                                                             
REQUIRED:                                                                    
                                                                             
--input_file input_file  The file name of previous version grid.             
       
</pre>        
        
</body>
</html>
